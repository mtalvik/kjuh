<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majaka tn 54 Invoice Splitter</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .input-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .invoice {
            background: white;
            padding: 25px;
            border-radius: 0;
            box-shadow: none;
            max-width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            font-size: 10px;
            line-height: 1.3;
            border: 1px solid #000;
            font-family: Arial, sans-serif;
        }
        
        .invoice-header {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 20px;
            align-items: start;
        }
        
        .sender-info h3 {
            font-size: 12px;
            font-weight: bold;
            margin: 0 0 3px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .sender-info p {
            margin: 0 0 2px 0;
            font-size: 10px;
        }
        
        .recipient-info h4 {
            font-size: 11px;
            font-weight: bold;
            margin: 0 0 3px 0;
            text-transform: uppercase;
        }
        
        .recipient-info p {
            margin: 0 0 2px 0;
            font-size: 10px;
        }
        
        .invoice-details {
            text-align: right;
        }
        
        .detail-box {
            border: 1px solid #000;
            padding: 8px;
            background: white;
            margin-bottom: 8px;
            font-size: 9px;
            line-height: 1.2;
        }
        
        .detail-box p {
            margin: 0 0 2px 0;
        }
        
        .detail-box strong {
            font-weight: bold;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 9px;
        }
        
        .invoice-table th,
        .invoice-table td {
            border: 1px solid #000;
            padding: 4px 3px;
            text-align: left;
            vertical-align: middle;
        }
        
        .invoice-table th {
            background-color: #f0f0f0;
            font-weight: bold;
            text-align: center;
            font-size: 8px;
        }
        
        .invoice-table td {
            text-align: left;
        }
        
        .amount {
            text-align: right !important;
        }
        
        .total-row {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        
        .invoice-summary {
            margin-bottom: 20px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
            font-size: 10px;
        }
        
        .summary-item.total {
            font-weight: bold;
            font-size: 11px;
            border-top: 1px solid #000;
            padding-top: 3px;
            margin-top: 8px;
        }
        
        .summary-text {
            margin-top: 12px;
            font-size: 9px;
        }
        
        .summary-text p {
            margin: 0 0 3px 0;
        }
        
        .summary-text .note {
            color: #666;
        }
        
        .summary-text .important {
            font-weight: bold;
            color: #000;
        }
        
        .consumption-table {
            margin-bottom: 15px;
        }
        
        .consumption-table h4 {
            font-size: 8px;
            font-weight: bold;
            margin: 0 0 4px 0;
            text-transform: uppercase;
        }
        
        .invoice-footer {
            text-align: center;
            font-size: 7px;
            color: #666;
            margin-top: 15px;
            border-top: 1px solid #ccc;
            padding-top: 8px;
        }
        
        .input-group {
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 10px;
            align-items: center;
        }
        
        .input-group label {
            font-weight: bold;
        }
        
        .input-group input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        .calculate-btn {
            background-color: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        
        .calculate-btn:hover {
            background-color: #0056b3;
        }
        
        .rates-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .meters-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .meter-section {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
        }
        
        .meter-section h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #333;
        }
        
        .korter1-col {
            background-color: #f9f9f9;
        }
        
        .korter2-col {
            background-color: #f9f9f9;
        }

        .error {
            background-color: #ffe6e6;
            border: 1px solid #ff9999;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            color: #cc0000;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Majaka tn 54 Invoice Splitter</h1>
        
        <div class="input-section">
            <h2>Invoice Input</h2>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
                <div class="input-group">
                    <label>Invoice Number:</label>
                    <input type="text" id="invoiceNumber" value="25089">
                </div>
                <div class="input-group">
                    <label>Period:</label>
                    <input type="text" id="period" value="07/2025">
                </div>
                <div class="input-group">
                    <label>Invoice Date:</label>
                    <input type="date" id="invoiceDate" value="2025-07-31">
                </div>
                <div class="input-group">
                    <label>Due Date:</label>
                    <input type="date" id="dueDate" value="2025-08-31">
                </div>
            </div>
            
            <h3>Shared Costs (per m²)</h3>
            <div class="rates-grid">
                <div class="input-group">
                    <label>Haldustasu:</label>
                    <input type="number" id="haldustasu" value="0.3689" step="0.0001">
                </div>
                <div class="input-group">
                    <label>Remondifond:</label>
                    <input type="number" id="remondifond" value="0.2347" step="0.0001">
                </div>
                <div class="input-group">
                    <label>Üldelekter:</label>
                    <input type="number" id="uldelekter" value="0.02464" step="0.00001">
                </div>
                <div class="input-group">
                    <label>Üldelekter (krt 9):</label>
                    <input type="number" id="uldelekterKrt9" value="0.02879" step="0.00001">
                </div>
                <div class="input-group">
                    <label>Küte:</label>
                    <input type="number" id="kute" value="0.00000" step="0.00001">
                </div>
                <div class="input-group">
                    <label>Prügivedu:</label>
                    <input type="number" id="prugivedu" value="0.08110" step="0.00001">
                </div>
            </div>
            
            <h3>Utility Rates</h3>
            <div class="rates-grid">
                <div class="input-group">
                    <label>Elekter (päevane):</label>
                    <input type="number" id="elektrPaevane" value="0.122624" step="0.000001">
                </div>
                <div class="input-group">
                    <label>Elekter (öine):</label>
                    <input type="number" id="elektrOine" value="0.096212" step="0.000001">
                </div>
                <div class="input-group">
                    <label>Vesi:</label>
                    <input type="number" id="vesi" value="2.6040" step="0.0001">
                </div>
                <div class="input-group">
                    <label>Vee soojendamine:</label>
                    <input type="number" id="veeSoojendamine" value="7.088670" step="0.000001">
                </div>
            </div>

            <h3>Additional Options</h3>
            <div class="input-group">
                <label>Include Viivised:</label>
                <input type="checkbox" id="includeViivised" checked>
            </div>
            <div class="input-group">
                <label>Viivised Amount:</label>
                <input type="number" id="viivisedAmount" value="0.05" step="0.01">
            </div>
            
            <h3>Meter Readings (Corrected from Invoice 25089)</h3>
            <div class="meters-grid">
                <div class="meter-section">
                    <h4>Külm vesi 1 (K1)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="kulmVesi1Algn" value="175.900" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="kulmVesi1Lopp" value="177.140" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Külm vesi 2 (K2)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="kulmVesi2Algn" value="166.360" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="kulmVesi2Lopp" value="176.280" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Soe vesi 1 (K1)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="soeVesi1Algn" value="124.550" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="soeVesi1Lopp" value="125.330" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Soe vesi 2 (K2)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="soeVesi2Algn" value="20.220" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="soeVesi2Lopp" value="22.420" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Päev elekter 1 (K1)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="paevaneElekter1Algn" value="3039.990" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="paevaneElekter1Lopp" value="3080.900" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Päev elekter 2 (K2)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="paevaneElekter2Algn" value="3902.100" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="paevaneElekter2Lopp" value="3973.550" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Öö elekter 1 (K1)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="oineElekter1Algn" value="2773.650" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="oineElekter1Lopp" value="2806.290" step="0.001">
                    </div>
                </div>
                
                <div class="meter-section">
                    <h4>Öö elekter 2 (K2)</h4>
                    <div class="input-group">
                        <label>Algn:</label>
                        <input type="number" id="oineElekter2Algn" value="3256.080" step="0.001">
                    </div>
                    <div class="input-group">
                        <label>Lõpp:</label>
                        <input type="number" id="oineElekter2Lopp" value="3290.550" step="0.001">
                    </div>
                </div>
            </div>
            
            <button class="calculate-btn" onclick="generateInvoice()">Generate Split Invoice</button>
        <button onclick="printInvoice()" class="print-btn" style="margin-left: 10px; padding: 10px 20px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">Print Invoice</button>
        </div>
        
        <div id="invoiceContainer">
            <!-- Generated invoice will appear here -->
        </div>
    </div>

    <script>
        const TOTAL_AREA = 79.90;
        const KORTER1_INDEX = 0.45557;
        const KORTER2_INDEX = 0.54443;
        const KORTER1_AREA = TOTAL_AREA * KORTER1_INDEX;
        const KORTER2_AREA = TOTAL_AREA * KORTER2_INDEX;

        function getInputValue(id) {
            return parseFloat(document.getElementById(id).value) || 0;
        }

        function formatNumber(num, decimals = 2) {
            return num.toFixed(decimals);
        }

        function generateInvoice() {
            console.log('Generating split invoice...');
            
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            const dueDate = document.getElementById('dueDate').value;
            const period = document.getElementById('period').value;

            // Get rates
            const haldustasu = getInputValue('haldustasu');
            const remondifond = getInputValue('remondifond');
            const uldelekter = getInputValue('uldelekter');
            const uldelekterKrt9 = getInputValue('uldelekterKrt9');
            const kute = getInputValue('kute');
            const prugivedu = getInputValue('prugivedu');
            const elektrPaevane = getInputValue('elektrPaevane');
            const elektrOine = getInputValue('elektrOine');
            const vesi = getInputValue('vesi');
            const veeSoojendamine = getInputValue('veeSoojendamine');

            // Get viivised settings
            const includeViivised = document.getElementById('includeViivised').checked;
            const viivisedAmount = includeViivised ? getInputValue('viivisedAmount') : 0;

            console.log('Viivised settings:', { includeViivised, viivisedAmount });

            // Calculate consumptions
            const kulmVesi1 = getInputValue('kulmVesi1Lopp') - getInputValue('kulmVesi1Algn');
            const kulmVesi2 = getInputValue('kulmVesi2Lopp') - getInputValue('kulmVesi2Algn');
            const soeVesi1 = getInputValue('soeVesi1Lopp') - getInputValue('soeVesi1Algn');
            const soeVesi2 = getInputValue('soeVesi2Lopp') - getInputValue('soeVesi2Algn');
            const paevaneElekter1 = getInputValue('paevaneElekter1Lopp') - getInputValue('paevaneElekter1Algn');
            const paevaneElekter2 = getInputValue('paevaneElekter2Lopp') - getInputValue('paevaneElekter2Algn');
            const oineElekter1 = getInputValue('oineElekter1Lopp') - getInputValue('oineElekter1Algn');
            const oineElekter2 = getInputValue('oineElekter2Lopp') - getInputValue('oineElekter2Algn');

            console.log('Consumptions:', {
                kulmVesi1, kulmVesi2, 
                soeVesi1, soeVesi2,
                paevaneElekter1, paevaneElekter2,
                oineElekter1, oineElekter2
            });

            // Calculate costs for Korter 1
            const k1_haldustasu = KORTER1_AREA * haldustasu;
            const k1_remondifond = KORTER1_AREA * remondifond;
            const k1_uldelekter = KORTER1_AREA * uldelekter;
            const k1_uldelekterKrt9 = KORTER1_AREA * uldelekterKrt9;
            const k1_kute = KORTER1_AREA * kute;
            const k1_prugivedu = KORTER1_AREA * prugivedu;
            const k1_elektrPaevane = paevaneElekter1 * elektrPaevane;
            const k1_elektrOine = oineElekter1 * elektrOine;
            const k1_vesi = (kulmVesi1 + soeVesi1) * vesi;
            const k1_veeSoojendamine = soeVesi1 * veeSoojendamine;

            // Calculate costs for Korter 2
            const k2_haldustasu = KORTER2_AREA * haldustasu;
            const k2_remondifond = KORTER2_AREA * remondifond;
            const k2_uldelekter = KORTER2_AREA * uldelekter;
            const k2_uldelekterKrt9 = KORTER2_AREA * uldelekterKrt9;
            const k2_kute = KORTER2_AREA * kute;
            const k2_prugivedu = KORTER2_AREA * prugivedu;
            const k2_elektrPaevane = paevaneElekter2 * elektrPaevane;
            const k2_elektrOine = oineElekter2 * elektrOine;
            const k2_vesi = (kulmVesi2 + soeVesi2) * vesi;
            const k2_veeSoojendamine = soeVesi2 * veeSoojendamine;

            // Calculate totals
            const total1 = k1_haldustasu + k1_remondifond + k1_uldelekter + k1_uldelekterKrt9 + k1_kute + k1_prugivedu + k1_elektrPaevane + k1_elektrOine + k1_vesi + k1_veeSoojendamine;
            const total2 = k2_haldustasu + k2_remondifond + k2_uldelekter + k2_uldelekterKrt9 + k2_kute + k2_prugivedu + k2_elektrPaevane + k2_elektrOine + k2_vesi + k2_veeSoojendamine;
            const grandTotal = total1 + total2;

            console.log('Totals:', { total1, total2, grandTotal });

            const invoice = `
                <div class="invoice">
                    <div class="invoice-header" style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div class="sender-info">
                            <h3>MAJAKA TN 54 KÜ</h3>
                            <p>Majaka tn 54</p>
                            <p>11412 Tallinn</p>
                            <p>Reg. nr 80541496</p>
                        </div>
                        <div class="recipient-info" style="text-align: right;">
                            <h4>MARIA TALVIK</h4>
                            <p>Majaka tn 54-9</p>
                            <p>11412 Tallinn</p>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 20px;">
                        <div></div>
                        <div style="text-align: right;">
                            <div class="detail-box" style="margin-bottom: 6px;">
                                <p><strong>ARVE nr</strong> ${invoiceNumber}</p>
                                <p><strong>Kuupäev</strong> ${invoiceDate.split('-').reverse().join('.')}</p>
                                <p><strong>Maksetähtaeg</strong> ${dueDate.split('-').reverse().join('.')}</p>
                                <p><strong>Viivis</strong> 0.022% päevas</p>
                                <p><strong>Viitenumber</strong> 97</p>
                                <p><strong>SWEDBANK</strong> EE772200221071147195</p>
                            </div>
                            <div class="detail-box">
                                <p><strong>Korter</strong> Majaka tn 54-9</p>
                                <p><strong>Pind</strong> ${formatNumber(TOTAL_AREA)} m²</p>
                                <p><strong>Köetav pind</strong> ${formatNumber(TOTAL_AREA)} m²</p>
                            </div>
                        </div>
                    </div>
                    
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>Kululiik</th>
                                <th>Periood</th>
                                <th>Kogus</th>
                                <th>Ühik</th>
                                <th>Hind</th>
                                <th>Summa</th>
                                <th>Korter 1</th>
                                <th>Korter 2</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Haldustasu</td>
                                <td>${period}</td>
                                <td>${formatNumber(TOTAL_AREA, 1)}</td>
                                <td>m²</td>
                                <td>${formatNumber(haldustasu, 4)}</td>
                                <td class="amount">${formatNumber(k1_haldustasu + k2_haldustasu)}</td>
                                <td class="amount">${formatNumber(k1_haldustasu)}</td>
                                <td class="amount">${formatNumber(k2_haldustasu)}</td>
                            </tr>
                            <tr>
                                <td>Remondifond</td>
                                <td>${period}</td>
                                <td>${formatNumber(TOTAL_AREA, 1)}</td>
                                <td>m²</td>
                                <td>${formatNumber(remondifond, 4)}</td>
                                <td class="amount">${formatNumber(k1_remondifond + k2_remondifond)}</td>
                                <td class="amount">${formatNumber(k1_remondifond)}</td>
                                <td class="amount">${formatNumber(k2_remondifond)}</td>
                            </tr>
                            <tr>
                                <td>Üldelekter</td>
                                <td>${period}</td>
                                <td>${formatNumber(TOTAL_AREA, 1)}</td>
                                <td>m²</td>
                                <td>${formatNumber(uldelekter, 5)}</td>
                                <td class="amount">${formatNumber(k1_uldelekter + k2_uldelekter)}</td>
                                <td class="amount">${formatNumber(k1_uldelekter)}</td>
                                <td class="amount">${formatNumber(k2_uldelekter)}</td>
                            </tr>
                            <tr>
                                <td>Üldelekter (krt 9)</td>
                                <td>${period}</td>
                                <td>${formatNumber(TOTAL_AREA, 1)}</td>
                                <td>m²</td>
                                <td>${formatNumber(uldelekterKrt9, 5)}</td>
                                <td class="amount">${formatNumber(k1_uldelekterKrt9 + k2_uldelekterKrt9)}</td>
                                <td class="amount">${formatNumber(k1_uldelekterKrt9)}</td>
                                <td class="amount">${formatNumber(k2_uldelekterKrt9)}</td>
                            </tr>
                            <tr>
                                <td>Elekter (päevane)</td>
                                <td>${period}</td>
                                <td>${formatNumber(paevaneElekter1 + paevaneElekter2, 2)}</td>
                                <td>kWh</td>
                                <td>${formatNumber(elektrPaevane, 6)}</td>
                                <td class="amount">${formatNumber(k1_elektrPaevane + k2_elektrPaevane)}</td>
                                <td class="amount">${formatNumber(k1_elektrPaevane)}</td>
                                <td class="amount">${formatNumber(k2_elektrPaevane)}</td>
                            </tr>
                            <tr>
                                <td>Elekter (öine)</td>
                                <td>${period}</td>
                                <td>${formatNumber(oineElekter1 + oineElekter2, 1)}</td>
                                <td>kWh</td>
                                <td>${formatNumber(elektrOine, 6)}</td>
                                <td class="amount">${formatNumber(k1_elektrOine + k2_elektrOine)}</td>
                                <td class="amount">${formatNumber(k1_elektrOine)}</td>
                                <td class="amount">${formatNumber(k2_elektrOine)}</td>
                            </tr>
                            <tr>
                                <td>Vesi</td>
                                <td>${period}</td>
                                <td>${formatNumber(kulmVesi1 + kulmVesi2 + soeVesi1 + soeVesi2, 2)}</td>
                                <td>m³</td>
                                <td>${formatNumber(vesi, 4)}</td>
                                <td class="amount">${formatNumber(k1_vesi + k2_vesi)}</td>
                                <td class="amount">${formatNumber(k1_vesi)}</td>
                                <td class="amount">${formatNumber(k2_vesi)}</td>
                            </tr>
                            <tr>
                                <td>Küte</td>
                                <td>${period}</td>
                                <td>${formatNumber(TOTAL_AREA, 1)}</td>
                                <td>m²</td>
                                <td>${formatNumber(kute, 5)}</td>
                                <td class="amount">${formatNumber(k1_kute + k2_kute)}</td>
                                <td class="amount">${formatNumber(k1_kute)}</td>
                                <td class="amount">${formatNumber(k2_kute)}</td>
                            </tr>
                            <tr>
                                <td>Vee soojendamine</td>
                                <td>${period}</td>
                                <td>${formatNumber(soeVesi1 + soeVesi2, 2)}</td>
                                <td>m³</td>
                                <td>${formatNumber(veeSoojendamine, 6)}</td>
                                <td class="amount">${formatNumber(k1_veeSoojendamine + k2_veeSoojendamine)}</td>
                                <td class="amount">${formatNumber(k1_veeSoojendamine)}</td>
                                <td class="amount">${formatNumber(k2_veeSoojendamine)}</td>
                            </tr>
                            <tr>
                                <td>Prügivedu</td>
                                <td>${period}</td>
                                <td>${formatNumber(TOTAL_AREA, 1)}</td>
                                <td>m²</td>
                                <td>${formatNumber(prugivedu, 5)}</td>
                                <td class="amount">${formatNumber(k1_prugivedu + k2_prugivedu)}</td>
                                <td class="amount">${formatNumber(k1_prugivedu)}</td>
                                <td class="amount">${formatNumber(k2_prugivedu)}</td>
                            </tr>
                            <tr class="total-row">
                                <td><strong>Kokku (EUR)</strong></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td class="amount"><strong>${formatNumber(grandTotal)}</strong></td>
                                <td class="amount"><strong>${formatNumber(total1)}</strong></td>
                                <td class="amount"><strong>${formatNumber(total2)}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="invoice-summary">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <tr>
                                <td style="padding: 5px; border: 1px solid #000;">Võlg (seisuga ${invoiceDate.split('-').reverse().join('.')})</td>
                                <td style="padding: 5px; border: 1px solid #000; text-align: right;">0.00</td>
                            </tr>
                            ${includeViivised ? `<tr>
                                <td style="padding: 5px; border: 1px solid #000;">Arvestatud viivised</td>
                                <td style="padding: 5px; border: 1px solid #000; text-align: right;">${formatNumber(viivisedAmount)}</td>
                            </tr>` : ''}
                            <tr style="background-color: #f0f0f0;">
                                <td style="padding: 5px; border: 1px solid #000;"><strong>Tasumisele kuulub (EUR)</strong></td>
                                <td style="padding: 5px; border: 1px solid #000; text-align: right;"><strong>${formatNumber(grandTotal + viivisedAmount)}</strong></td>
                            </tr>
                        </table>
                        <div class="summary-text">
                            <p><strong>Summa sõnadega:</strong> ükssada kolmkümmend seitse eurot ja 16 senti</p>
                            <p><strong>Eelmisel kuul laekunud summa:</strong> 0.00</p>
                            <p class="note">Tasumisele kuuluvale summale võib lisanduda viivis jooksva kuu eest 0.022% päevas.</p>
                            <p class="important">Palume kindlasti märkida tasumisel viitenumber!</p>
                        </div>
                    </div>
                    
                    <div class="invoice-footer">
                        <p>Kasutame www.korto.ee veebitarkvara</p>
                    </div>
                    
                    <div class="consumption-table">
                        <h4>TARBIMISTE ÜLEVAADE</h4>
                        <table class="invoice-table">
                            <thead>
                                <tr>
                                    <th>Arvesti</th>
                                    <th>Algnäit</th>
                                    <th>Lõppnäit</th>
                                    <th>Kogus</th>
                                    <th>Koef.</th>
                                    <th>Korr. kogus</th>
                                    <th>Ühik</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Majaka tn 54-9 Külm vesi (1)</td>
                                    <td>${getInputValue('kulmVesi1Algn').toFixed(3)}</td>
                                    <td>${getInputValue('kulmVesi1Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(kulmVesi1, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(kulmVesi1, 3)}</td>
                                    <td>m³</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Külm vesi (2)</td>
                                    <td>${getInputValue('kulmVesi2Algn').toFixed(3)}</td>
                                    <td>${getInputValue('kulmVesi2Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(kulmVesi2, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(kulmVesi2, 3)}</td>
                                    <td>m³</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Soe vesi (1)</td>
                                    <td>${getInputValue('soeVesi1Algn').toFixed(3)}</td>
                                    <td>${getInputValue('soeVesi1Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(soeVesi1, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(soeVesi1, 3)}</td>
                                    <td>m³</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Soe vesi (2)</td>
                                    <td>${getInputValue('soeVesi2Algn').toFixed(3)}</td>
                                    <td>${getInputValue('soeVesi2Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(soeVesi2, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(soeVesi2, 3)}</td>
                                    <td>m³</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Päevane elekter (1)</td>
                                    <td>${getInputValue('paevaneElekter1Algn').toFixed(3)}</td>
                                    <td>${getInputValue('paevaneElekter1Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(paevaneElekter1, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(paevaneElekter1, 3)}</td>
                                    <td>kWh</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Päevane elekter (2)</td>
                                    <td>${getInputValue('paevaneElekter2Algn').toFixed(3)}</td>
                                    <td>${getInputValue('paevaneElekter2Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(paevaneElekter2, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(paevaneElekter2, 3)}</td>
                                    <td>kWh</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Öine elekter (1)</td>
                                    <td>${getInputValue('oineElekter1Algn').toFixed(3)}</td>
                                    <td>${getInputValue('oineElekter1Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(oineElekter1, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(oineElekter1, 3)}</td>
                                    <td>kWh</td>
                                </tr>
                                <tr>
                                    <td>Majaka tn 54-9 Öine elekter (2)</td>
                                    <td>${getInputValue('oineElekter2Algn').toFixed(3)}</td>
                                    <td>${getInputValue('oineElekter2Lopp').toFixed(3)}</td>
                                    <td>${formatNumber(oineElekter2, 3)}</td>
                                    <td></td>
                                    <td>${formatNumber(oineElekter2, 3)}</td>
                                    <td>kWh</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;

            document.getElementById('invoiceContainer').innerHTML = invoice;
        }

        function printInvoice() {
            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            
            // Get the generated invoice HTML
            const invoiceContainer = document.getElementById('invoice-container');
            if (!invoiceContainer || !invoiceContainer.innerHTML.trim()) {
                alert('Please generate an invoice first!');
                return;
            }
            
            // Create the print HTML
            const printHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Invoice - Majaka tn 54</title>
                    <style>
                        @media print {
                            @page {
                                margin: 1cm;
                                size: A4;
                            }
                        }
                        
                        body {
                            font-family: Arial, sans-serif;
                            margin: 0;
                            padding: 20px;
                            font-size: 12px;
                            line-height: 1.4;
                        }
                        
                        .invoice {
                            max-width: 100%;
                            margin: 0 auto;
                        }
                        
                        .invoice-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: flex-start;
                            margin-bottom: 30px;
                        }
                        
                        .sender-info h3, .recipient-info h4 {
                            margin: 0 0 10px 0;
                            font-size: 16px;
                        }
                        
                        .sender-info p, .recipient-info p {
                            margin: 5px 0;
                            font-size: 12px;
                        }
                        
                        .invoice-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                            font-size: 11px;
                        }
                        
                        .invoice-table th, .invoice-table td {
                            border: 1px solid #000;
                            padding: 4px 6px;
                            text-align: left;
                        }
                        
                        .invoice-table th {
                            background-color: #f0f0f0;
                            font-weight: bold;
                        }
                        
                        .amount {
                            text-align: right;
                        }
                        
                        .total-row {
                            background-color: #f0f0f0;
                            font-weight: bold;
                        }
                        
                        .invoice-summary {
                            margin-top: 30px;
                        }
                        
                        .invoice-summary table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }
                        
                        .invoice-summary td {
                            border: 1px solid #000;
                            padding: 5px;
                        }
                        
                        .summary-text {
                            margin-top: 20px;
                            font-size: 11px;
                        }
                        
                        .summary-text p {
                            margin: 5px 0;
                        }
                        
                        .invoice-footer {
                            margin-top: 30px;
                            text-align: center;
                            font-size: 10px;
                            color: #666;
                        }
                        
                        .consumption-table {
                            margin-top: 30px;
                            page-break-before: always;
                        }
                        
                        .consumption-table h4 {
                            margin: 0 0 15px 0;
                            font-size: 14px;
                        }
                        
                        @media print {
                            .no-print {
                                display: none;
                            }
                        }
                    </style>
                </head>
                <body>
                    ${invoiceContainer.innerHTML}
                </body>
                </html>
            `;
            
            // Write the HTML to the new window
            printWindow.document.write(printHTML);
            printWindow.document.close();
            
            // Wait for content to load, then print
            printWindow.onload = function() {
                printWindow.print();
                printWindow.close();
            };
        }
    </script>
</body>
</html>